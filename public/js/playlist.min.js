!function(){const n=angular.module("songApp",[]);n.factory("songDB",function(n,t){return{loadSongs:function(){return t(function(t,o){n.get("/playlist/songs/data").then(function(n){t(n.data)},function(n){o(n)})})},addSong:function(o){return t(function(t,e){n.post("/playlist/songs",o).then(function(n){t("success")},function(n){e(n)})})},addVote:function(o){return t(function(t,e){n.patch("/playlist/songs/vote",{id:o}).then(function(n){t(n)},function(n){e(n)})})}}}),n.factory("searchSong",function(n,t){return{search:function(o,e){return t(function(t,r){let a="http://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=3b1290c0aeeec4b9937434d3b63bb229&artist="+encodeURIComponent(e)+"&track="+encodeURIComponent(o)+"&format=json";n.get(a).then(function(n){if(console.log(n),n.data.error)r(n.data.message);else{let o={title:n.data.track.name,artist:n.data.track.artist.name,link:encodeURIComponent(this.title+" "+this.artist),genre:[],votes:0};n.data.track.toptags.tag.forEach(n=>{o.genre.push(n.name)}),t(o)}},function(n){r(n.data.message)})})}}}),n.controller("SongsCtrl",function(n,t){n.songs=[],n.songs=t.loadSongs().then(function(t){n.songs=t},function(n){console.log(n)})}),n.controller("SongListCntrl",function(n,t,o){n.addVote=function(t,e){e.preventDefault(),e.currentTarget.setAttribute("disabled","true"),o.addVote(t).then(function(t){let o=n.songs.findIndex(n=>n._id===t.data.id);n.songs[o].votes=t.data.votes},function(n){console.log(n)})}}),n.controller("SongSearchCntrl",function(n,t,o,e){let r=n;r.search={track:"",artist:""},r.result={},r.found=!1,r.error=!1,r.errorMsg="",r.clearResult=function(){r.found=!1,r.error=!1},r.searchSong=function(n,t,o){o.preventDefault(),e.search(n,t).then(function(n){r.result=n,r.error=!1},function(n){r.error=!0,r.errorMsg=n,r.result={}}),r.found=!0},n.addSong=function(n,t){t.preventDefault();let e=n;o.addSong(e).then(function(){r.found=!1,location.reload()},function(n){console.log(n)})}})}();